{% extends "base.twig" %}

{% block title %}{{ title }}{% endblock %}

{% block content %}
<style>
    @keyframes fadeInUp {
        from { opacity: 0; transform: translateY(30px); }
        to { opacity: 1; transform: translateY(0); }
    }
    @keyframes fadeIn {
        from { opacity: 0; }
        to { opacity: 1; }
    }
    @keyframes slideDown {
        from { opacity: 0; transform: translateY(-20px); }
        to { opacity: 1; transform: translateY(0); }
    }
    @keyframes float {
        0%, 100% { transform: translateY(0px); }
        50% { transform: translateY(-10px); }
    }
    @keyframes pulseGlow {
        0%, 100% { box-shadow: 0 0 20px rgba(26,26,26,0.3); }
        50% { box-shadow: 0 0 40px rgba(26,26,26,0.6); }
    }
    @keyframes gradientShift {
        0% { background-position: 0% 50%; }
        50% { background-position: 100% 50%; }
        100% { background-position: 0% 50%; }
    }

    .animate-fade-in-up { animation: fadeInUp 0.8s cubic-bezier(0.16,1,0.3,1) forwards; }
    .animate-fade-in { animation: fadeIn 0.6s cubic-bezier(0.16,1,0.3,1); }
    .animate-slide-down { animation: slideDown 0.5s cubic-bezier(0.16,1,0.3,1); }
    .stagger-1 { animation-delay: 0.1s; opacity: 0; }
    .stagger-2 { animation-delay: 0.2s; opacity: 0; }

    /* FILTER CARD */
    .filter-card {
        background: linear-gradient(145deg,#ffffff 0%,#f8fafc 100%);
        border: 2px solid #e5e7eb;
        transition: all 0.4s cubic-bezier(0.16,1,0.3,1);
    }
    @media (min-width: 1024px) {
        .filter-card {
            position: sticky;
            top: 6rem;
            max-height: calc(100vh - 7rem);
            overflow-y: auto;
            z-index: 20;
        }
    }
    .filter-card:hover {
        transform: translateY(-8px);
        box-shadow: 0 25px 50px -12px rgba(0,0,0,0.25);
        border-color: #1A1A1A;
    }

    /* Product cards */
    .product-card {
        transition: all 0.4s cubic-bezier(0.16,1,0.3,1);
        background: linear-gradient(145deg,#ffffff 0%,#f8fafc 100%);
        border: 2px solid #e5e7eb;
        position: relative;
        overflow: hidden;
        opacity: 0;
        animation: fadeInUp 0.7s cubic-bezier(0.16,1,0.3,1) forwards;
    }
    .product-card::before {
        content: '';
        position: absolute;
        top: 0; left: -100%;
        width: 100%; height: 100%;
        background: linear-gradient(90deg,transparent,rgba(255,255,255,0.4),transparent);
        transition: left 0.8s;
        z-index: 1;
    }
    .product-card:hover::before { left: 100%; }
    .product-card:hover {
        transform: translateY(-16px) scale(1.02);
        box-shadow: 0 35px 60px -15px rgba(0,0,0,0.3),0 0 0 1px rgba(26,26,26,0.1);
        border-color: #1A1A1A;
    }
    .product-card:nth-child(1){animation-delay:0.05s;}
    .product-card:nth-child(2){animation-delay:0.1s;}
    .product-card:nth-child(3){animation-delay:0.15s;}
    .product-card:nth-child(4){animation-delay:0.2s;}
    .product-card:nth-child(5){animation-delay:0.25s;}
    .product-card:nth-child(6){animation-delay:0.3s;}
    .product-card:nth-child(7){animation-delay:0.35s;}
    .product-card:nth-child(8){animation-delay:0.4s;}

    .product-image-wrapper {
        position: relative;
        overflow: hidden;
        background: linear-gradient(145deg,#f1f5f9 0%,#ffffff 100%);
    }
    .product-grid-img {
        width: 100%;
        height: 100%;
        object-fit: contain;
        object-position: center;
        transition: all 0.6s cubic-bezier(0.16,1,0.3,1);
    }
    .product-card:hover .product-grid-img {
        transform: scale(1.15) rotate(1deg);
    }

    .sale-badge {
        position: absolute;
        top: 12px;
        right: 12px;
        background: linear-gradient(135deg,#1A1A1A 0%,#2d2d2d 100%);
        color: #fff;
        padding: 6px 14px;
        border-radius: 25px;
        font-size: 0.75rem;
        font-weight: 700;
        z-index: 10;
        box-shadow: 0 4px 15px rgba(0,0,0,0.3);
        animation: pulseGlow 2s ease-in-out infinite;
        pointer-events: none;
    }

    .btn-primary {
        background: linear-gradient(135deg,#1A1A1A 0%,#2d2d2d 100%);
        border: 2px solid #1A1A1A;
        color: #fff;
        transition: all 0.4s cubic-bezier(0.16,1,0.3,1);
        background-size: 200% auto;
        animation: gradientShift 3s ease infinite;
        cursor: pointer;
    }
    .btn-primary:hover {
        transform: translateY(-3px) scale(1.02);
        box-shadow: 0 20px 40px rgba(26,26,26,0.4);
        background-position: 100% 50%;
    }
    .mobile-filter-btn {
        background: linear-gradient(135deg,#1A1A1A 0%,#2d2d2d 100%);
        border: 2px solid #1A1A1A;
        color: #fff;
        transition: all 0.4s cubic-bezier(0.16,1,0.3,1);
        animation: gradientShift 3s ease infinite;
        cursor: pointer;
    }
    .mobile-filter-btn:hover {
        transform: translateY(-3px);
        box-shadow: 0 20px 40px rgba(26,26,26,0.4);
    }

    select,input {
        transition: all 0.3s cubic-bezier(0.16,1,0.3,1);
        border: 2px solid #e5e7eb;
        background: linear-gradient(145deg,#ffffff 0%,#f8fafc 100%);
        cursor: pointer;
    }
    select:focus,input:focus {
        outline: none;
        border-color: #1A1A1A;
        box-shadow: 0 0 0 4px rgba(26,26,26,0.1);
        transform: translateY(-2px);
    }

    .category-title {
        background: linear-gradient(135deg,#1A1A1A 0%,#2d2d2d 100%);
        -webkit-background-clip: text;
        -webkit-text-fill-color: transparent;
        background-clip: text;
        position: relative;
    }
    .category-title::after {
        content: '';
        position: absolute;
        bottom: -12px;
        left: 50%;
        transform: translateX(-50%);
        width: 80px;
        height: 4px;
        background: linear-gradient(90deg,transparent,#1A1A1A,transparent);
        border-radius: 2px;
    }
    .breadcrumb-link {
        position: relative;
        transition: all 0.3s ease;
        color: #6b7280;
        cursor: pointer;
    }
    .breadcrumb-link::after {
        content: '';
        position: absolute;
        bottom: -3px;
        left: 0;
        width: 0;
        height: 2px;
        background: linear-gradient(135deg,#1A1A1A 0%,#2d2d2d 100%);
        transition: width 0.4s cubic-bezier(0.16,1,0.3,1);
        border-radius: 1px;
    }
    .breadcrumb-link:hover::after { width: 100%; }
    .breadcrumb-link:hover { color: #1A1A1A; }

    .sort-bar {
        background: linear-gradient(145deg,#ffffff 0%,#f8fafc 100%);
        border: 2px solid #e5e7eb;
        backdrop-filter: blur(20px);
    }
    .empty-state {
        background: linear-gradient(145deg,#ffffff 0%,#f8fafc 100%);
        border: 2px solid #e5e7eb;
        animation: fadeInUp 0.8s cubic-bezier(0.16,1,0.3,1);
    }

    .price-highlight {
        background: linear-gradient(135deg,#1A1A1A 0%,#2d2d2d 100%);
        -webkit-background-clip: text;
        -webkit-text-fill-color: transparent;
        background-clip: text;
    }
    .price-strikethrough { color: #9ca3af !important; }

    .price-row{
        display:flex;
        align-items:center;
        gap:0.4rem;
        flex-wrap:wrap;
    }
    @media (max-width:640px){
        .price-row span{ font-size:0.95rem; }
    }
    @media (max-width:1024px){
        .product-card:hover{ transform: translateY(-8px) scale(1.01); }
    }

    .product-title{
        display:-webkit-box;
        -webkit-box-orient:vertical;
        overflow:hidden;
        font-weight:700;
        line-height:1.25;
        color:var(--brand-text);
    }
    @media (max-width:640px){
        .product-title{
            font-size:0.85rem;
            -webkit-line-clamp:3;
            min-height:3.2rem;
        }
    }
    @media (min-width:641px){
        .product-title{
            font-size:0.95rem;
            -webkit-line-clamp:2;
            min-height:3rem;
        }
    }
</style>

<section class="py-14 bg-gradient-to-b from-white to-gray-50">
    <div class="container mx-auto px-4">

        <!-- Breadcrumb -->
        <div class="mb-6 text-sm animate-fade-in">
            <a href="{{ app_url }}/" class="breadcrumb-link font-medium">Home</a>
            <span class="mx-3 text-gray-400">/</span>
            <a href="{{ app_url }}/categories" class="breadcrumb-link font-medium">Categories</a>
            <span class="mx-3 text-gray-400">/</span>
            <strong class="category-title text-2xl font-black">{{ category.name }}</strong>
        </div>

        <h1 class="text-4xl md:text-6xl font-black mb-12 category-title animate-fade-in-up text-center md:text-left">
            {{ category.name }}
        </h1>

        <div class="grid grid-cols-1 lg:grid-cols-4 gap-10">

            <!-- Sidebar -->
            <aside class="lg:col-span-1 animate-fade-in-up stagger-1">
                <div class="lg:hidden mb-6">
                    <button onclick="toggleMobileFilters()"
                            class="mobile-filter-btn w-full px-6 py-4 text-white font-black rounded-2xl shadow-2xl text-lg">
                        <span class="flex items-center justify-center gap-3">
                            <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                      d="M3 4a1 1 0 011-1h16a1 1 0 011 1v2.586a1 1 0 01-.293.707l-6.414 6.414a1 1 0 00-.293.707V17l-4 4v-6.586a1 1 0 00-.293-.707L3.293 7.293A1 1 0 013 6.586V4z"/>
                            </svg>
                            Filters & Sort
                        </span>
                    </button>
                </div>

                <div id="mobileFilters" class="hidden lg:block animate-slide-down">
                    <div class="filter-card p-8 rounded-3xl shadow-2xl">
                        <h3 class="text-xl font-black mb-8 category-title flex items-center gap-3">
                            <svg class="w-7 h-7" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                      d="M12 6V4m0 2a2 2 0 100 4m0-4a2 2 0 110 4m-6 8a2 2 0 100-4m0 4a2 2 0 110-4m0 4v2m0-6V4m6 6v10m6-2a2 2 0 100-4m0 4a2 2 0 110-4m0 4v2m0-6V4"/>
                            </svg>
                            Advanced Filters
                        </h3>

                        <form method="GET" id="filterForm" class="space-y-8">
                            {% if subcategories|length > 0 %}
                            <div>
                                <label class="block text-sm font-black mb-4 category-title">Product Type</label>
                                <select name="subcategory" class="w-full px-4 py-3 rounded-2xl text-lg" onchange="this.form.submit()">
                                    <option value="">All Types</option>
                                    {% for sub in subcategories %}
                                        <option value="{{ sub.id }}" {% if filters.subcategory_id == sub.id %}selected{% endif %}>
                                            {{ sub.name }} ({{ sub.product_count }})
                                        </option>
                                    {% endfor %}
                                </select>
                            </div>
                            {% endif %}

                            {% if brands|length > 0 %}
                            <div>
                                <label class="block text-sm font-black mb-4 category-title">Brand</label>
                                <select name="brand" class="w-full px-4 py-3 rounded-2xl text-lg" onchange="this.form.submit()">
                                    <option value="">All Brands</option>
                                    {% for brand in brands %}
                                        <option value="{{ brand.id }}" {% if filters.brand_id == brand.id %}selected{% endif %}>
                                            {{ brand.name }} ({{ brand.product_count }})
                                        </option>
                                    {% endfor %}
                                </select>
                            </div>
                            {% endif %}

                            {% if models|length > 0 %}
                            <div>
                                <label class="block text-sm font-black mb-4 category-title">Model</label>
                                <select name="model" class="w-full px-4 py-3 rounded-2xl text-lg" onchange="this.form.submit()">
                                    <option value="">All Models</option>
                                    {% for model in models %}
                                        <option value="{{ model.id }}" {% if filters.model_id == model.id %}selected{% endif %}>
                                            {{ model.name }}
                                        </option>
                                    {% endfor %}
                                </select>
                            </div>
                            {% endif %}

                            <div class="border-t border-gray-200 pt-8">
                                <label class="block text-sm font-black mb-5 category-title">Price Range</label>
                                <div class="grid grid-cols-2 gap-4 mb-6">
                                    <input type="number" name="min_price" placeholder="Min ‚Çπ"
                                           value="{{ filters.min_price }}"
                                           class="w-full px-4 py-3 rounded-2xl text-lg font-semibold">
                                    <input type="number" name="max_price" placeholder="Max ‚Çπ"
                                           value="{{ filters.max_price }}"
                                           class="w-full px-4 py-3 rounded-2xl text-lg font-semibold">
                                </div>
                                <button type="submit"
                                        class="btn-primary w-full px-6 py-4 text-lg font-black rounded-2xl shadow-2xl">
                                    üîç Apply Filters
                                </button>
                            </div>

                            <a href="{{ app_url }}/category/{{ category.slug }}"
                               class="block w-full px-6 py-4 border-2 border-gray-300 rounded-2xl text-center font-black text-lg text-gray-700 hover:border-black hover:text-black transition-all duration-300 hover:shadow-xl">
                                üßπ Clear All Filters
                            </a>
                        </form>
                    </div>
                </div>
            </aside>

            <!-- Products -->
            <main class="lg:col-span-3 animate-fade-in-up stagger-2">
                <div class="sort-bar p-6 rounded-3xl shadow-xl mb-10">
                    <div class="flex flex-col md:flex-row justify-between items-start md:items-center gap-6">
                        <p class="text-lg font-semibold text-gray-700">
                            Showing <span class="category-title font-black">{{ products|length }}</span> of
                            <span class="category-title font-black">{{ pagination.total }}</span> products
                        </p>

                        <form method="GET" class="w-full md:w-auto">
                            {% for key, value in filters %}
                                {% if key != 'sort' and value %}
                                    <input type="hidden" name="{{ key }}" value="{{ value }}">
                                {% endif %}
                            {% endfor %}
                            <select name="sort"
                                    class="w-full md:w-72 px-5 py-3 border-2 border-gray-300 rounded-2xl bg-white text-lg font-semibold shadow-md"
                                    onchange="this.form.submit()">
                                <option value="p.created_at DESC" {% if filters.sort == 'p.created_at DESC' %}selected{% endif %}>‚ú® Newest First</option>
                                <option value="p.price ASC"       {% if filters.sort == 'p.price ASC' %}selected{% endif %}>üí∞ Price: Low to High</option>
                                <option value="p.price DESC"      {% if filters.sort == 'p.price DESC' %}selected{% endif %}>üíé Price: High to Low</option>
                                <option value="p.name ASC"        {% if filters.sort == 'p.name ASC' %}selected{% endif %}>üìù Name: A to Z</option>
                            </select>
                        </form>
                    </div>
                </div>

                {% if products|length > 0 %}
                <div class="grid grid-cols-2 sm:grid-cols-3 lg:grid-cols-4 gap-8 mb-12">
                    {% for product in products %}
                    <a href="{{ app_url }}/product/{{ product.slug }}"
                       class="product-card group overflow-hidden rounded-3xl shadow-2xl h-full">
                        <div class="product-image-wrapper aspect-square relative">
                            {% if product.sale_price %}
                                <div class="sale-badge">üî• SALE</div>
                            {% endif %}
                            {% if product.image_path %}
                                <img src="{{ product.image_path }}" alt="{{ product.name }}" class="product-grid-img">
                            {% else %}
                                <div class="w-full h-full flex items-center justify-center bg-gradient-to-br from-gray-100 to-gray-200">
                                    <div class="text-5xl animate-pulse">üì¶</div>
                                </div>
                            {% endif %}
                        </div>
                        <div class="p-6 bg-white">
                            {% if product.brand_name %}
                            <p class="text-xs font-black uppercase tracking-wider mb-3 text-gray-600">
                                {{ product.brand_name }}
                            </p>
                            {% endif %}
                            <h3 class="product-title mb-4">
                                {{ product.name }}
                            </h3>
                            <div class="price-row">
                                {% if product.sale_price %}
                                    <span class="text-2xl font-black price-highlight">‚Çπ{{ product.sale_price }}</span>
                                    <span class="text-sm font-medium price-strikethrough line-through">‚Çπ{{ product.price }}</span>
                                {% else %}
                                    <span class="text-2xl font-black price-highlight">‚Çπ{{ product.price }}</span>
                                {% endif %}
                            </div>
                        </div>
                    </a>
                    {% endfor %}
                </div>

                {% if pagination.total_pages > 1 %}
                <div class="flex justify-center gap-2 mb-4">
                    {% for page in 1..pagination.total_pages %}
                        {% if page == pagination.current_page %}
                            <span class="px-4 py-2 bg-[var(--brand-navbar)] text-white rounded-xl text-sm font-semibold">
                                {{ page }}
                            </span>
                        {% else %}
                            <a href="?page={{ page }}{% for key,value in filters %}{% if value and key != 'page' %}&{{ key }}={{ value|url_encode }}{% endif %}{% endfor %}"
                               class="px-4 py-2 border border-[var(--card-border)] rounded-xl text-sm hover:bg-[var(--card-bg-alt)] transition">
                                {{ page }}
                            </a>
                        {% endif %}
                    {% endfor %}
                </div>
                {% endif %}

                {% else %}
                <div class="empty-state p-20 rounded-3xl shadow-2xl text-center mx-auto max-w-2xl">
                    <div class="text-8xl mb-8 animate-float">üîç</div>
                    <h3 class="text-4xl font-black mb-6 category-title">No Products Found</h3>
                    <p class="text-xl text-gray-600 mb-10 font-medium leading-relaxed">
                        Try adjusting your filters or check back later for new arrivals
                    </p>
                    <a href="{{ app_url }}/category/{{ category.slug }}"
                       class="inline-block px-10 py-5 btn-primary text-xl font-black rounded-3xl shadow-2xl">
                        ‚ú® Clear All Filters
                    </a>
                </div>
                {% endif %}
            </main>
        
        </div>
    </div>
</section>

<script>
function toggleMobileFilters(){
    const el = document.getElementById('mobileFilters');
    if (el) {
        el.classList.toggle('hidden');
    }
}
</script>
{% endblock %}
