<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>{% block title %}BackRoar — Mobile Cases & Accessories{% endblock %}</title>
    <meta name="csrf-token" content="{{ csrf_token }}">
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&display=swap" rel="stylesheet" />
    <style>
        :root {
            --brand-bg: #F5F5F5;
            --brand-navbar: #1A1A1A;
            --brand-footer: #1A1A1A;
            --brand-heading: #88898A;
            --brand-text: #1A1A1A;
            --brand-primary: #88898A;
            --brand-primary-hover: #C4C4C4;
            --brand-accent: #0066FF;
            --card-bg: #FFFFFF;
            --card-bg-alt: #F5F5F5;
            --card-border: #C4C4C4;
            --brand-light: #F5F5F5;
        }
        body { font-family: 'Poppins', sans-serif; color: var(--brand-text); margin: 0; padding: 0; overflow-x: hidden; }

        /* ========== MARVEL INTRO STYLES ========== */
        #marvel-intro {
            position: fixed;
            top: 0;
            left: 0;
            width: 100vw;
            height: 100vh;
            background: #000;
            z-index: 99999;
            display: flex;
            align-items: center;
            justify-content: center;
            overflow: hidden;
        }

        #marvel-intro.hidden {
            display: none;
        }

        .intro-container {
            position: relative;
            width: 100%;
            height: 100%;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .particles {
            position: absolute;
            width: 100%;
            height: 100%;
            overflow: hidden;
        }

        .particle {
            position: absolute;
            background: rgba(255, 255, 255, 0.3);
            border-radius: 50%;
            animation: float 3s infinite ease-in-out;
        }

        @keyframes float {
            0%, 100% { transform: translateY(0) translateX(0); opacity: 0; }
            50% { opacity: 1; }
        }

        .logo-wrapper {
            position: relative;
            z-index: 2;
            animation: logoReveal 3s ease-out forwards;
        }

        .logo-image {
            width: 400px;
            height: auto;
            max-width: 80vw;
            filter: drop-shadow(0 0 30px rgba(136, 137, 138, 0.8));
            animation: logoGlow 2s ease-in-out infinite alternate;
        }

        @keyframes logoReveal {
            0% {
                opacity: 0;
                transform: scale(0.3) rotateY(180deg);
            }
            40% {
                opacity: 1;
                transform: scale(1.2) rotateY(0deg);
            }
            60% {
                transform: scale(0.95) rotateY(0deg);
            }
            100% {
                opacity: 1;
                transform: scale(1) rotateY(0deg);
            }
        }

        @keyframes logoGlow {
            0% {
                filter: drop-shadow(0 0 20px rgba(136, 137, 138, 0.6));
            }
            100% {
                filter: drop-shadow(0 0 40px rgba(136, 137, 138, 1));
            }
        }

        .radial-burst {
            position: absolute;
            width: 100%;
            height: 100%;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
        }

        .burst-line {
            position: absolute;
            top: 50%;
            left: 50%;
            width: 2px;
            height: 100px;
            background: linear-gradient(transparent, rgba(136, 137, 138, 0.8), transparent);
            transform-origin: top center;
            animation: burstExpand 2s ease-out forwards;
        }

        @keyframes burstExpand {
            0% {
                height: 0;
                opacity: 1;
            }
            100% {
                height: 600px;
                opacity: 0;
            }
        }

        .brand-text {
            position: absolute;
            bottom: 20%;
            left: 50%;
            transform: translateX(-50%);
            font-size: 3rem;
            font-weight: 700;
            color: #fff;
            letter-spacing: 0.5rem;
            text-transform: uppercase;
            opacity: 0;
            animation: textReveal 2s 1.5s ease-out forwards;
        }

        @media (max-width: 768px) {
            .brand-text {
                font-size: 2rem;
                letter-spacing: 0.3rem;
            }
        }

        @keyframes textReveal {
            0% {
                opacity: 0;
                letter-spacing: 2rem;
            }
            100% {
                opacity: 1;
                letter-spacing: 0.5rem;
            }
        }

        @keyframes fadeOut {
            to {
                opacity: 0;
                visibility: hidden;
            }
        }

        .fade-out {
            animation: fadeOut 0.8s 3.5s ease-out forwards;
        }

        #main-content {
            opacity: 0;
            animation: contentFadeIn 0.8s 4s ease-out forwards;
        }

        @keyframes contentFadeIn {
            to {
                opacity: 1;
            }
        }
        /* ========== END MARVEL INTRO STYLES ========== */

        /* navbar animations */
        @keyframes navFadeDown {
            from { opacity:0; transform:translateY(-10px); }
            to   { opacity:1; transform:translateY(0); }
        }
        @keyframes navGlowDot {
            0%,100% { transform:scale(1); opacity:.7; }
            50%     { transform:scale(1.3); opacity:.3; }
        }

        .nav-container { animation: navFadeDown .4s ease-out; }

        .nav-chip {
            display:inline-flex;
            align-items:center;
            gap:.35rem;
            padding:.15rem .6rem;
            border-radius:999px;
            background:#111827;
            color:#f9fafb;
            font-size:.65rem;
            letter-spacing:.18em;
            text-transform:uppercase;
        }
        .nav-chip span.dot {
            width:.45rem;
            height:.45rem;
            border-radius:999px;
            background:#f9fafb;
            animation:navGlowDot 2.4s ease-in-out infinite;
        }

        .nav-link {
            position:relative;
            font-size:.78rem;
            letter-spacing:.16em;
            text-transform:uppercase;
            color:var(--brand-text);
            transition:color .2s ease, transform .2s ease;
        }
        .nav-link::after {
            content:'';
            position:absolute;
            left:0;
            bottom:-4px;
            height:1px;
            width:0;
            background:#111827;
            opacity:0;
            transition:width .2s ease, opacity .2s ease;
        }
        .nav-link:hover {
            color:#000000;
            transform:translateY(-1px);
        }
        .nav-link:hover::after {
            width:100%;
            opacity:1;
        }

        .nav-input {
            border-radius:.9rem;
            border:1px solid var(--card-border);
            background:#f9fafb;
            transition:all .2s ease;
            font-size:.8rem;
        }
        .nav-input::placeholder { color:#9ca3af; }
        .nav-input:focus {
            background:#ffffff;
            border-color:#111827;
            box-shadow:0 0 0 1px #111827,0 0 0 3px rgba(15,23,42,0.12);
            outline:none;
            transform:translateY(-1px);
        }

        .nav-cta {
            border-radius:.9rem;
            background:#111827;
            color:#f9fafb;
            font-size:.75rem;
            font-weight:600;
            letter-spacing:.12em;
            text-transform:uppercase;
            transition:all .25s ease;
        }
        .nav-cta:hover {
            background:#000000;
            transform:translateY(-1px);
            box-shadow:0 10px 30px rgba(15,23,42,0.30);
        }

        .nav-user-btn {
            border-radius:.9rem;
            background:#f3f4f6;
            color:#111827;
            font-size:.75rem;
            letter-spacing:.12em;
            text-transform:uppercase;
            transition:all .2s ease;
        }
        .nav-user-btn:hover {
            background:#e5e7eb;
            transform:translateY(-1px);
        }

        .badge { display:inline-block; padding:0.25rem 0.6rem; font-size:0.75rem; border-radius:999px; background:var(--brand-primary); color:#fff; }
        .btn-primary { background:var(--brand-primary); color:#fff; }
        .btn-primary:hover { background:var(--brand-primary-hover); }
        .btn-accent { background:var(--brand-accent); color:#fff; }
        .btn-accent:hover { background:#3388ff; }
        .link-hover:hover { color:var(--brand-primary); }
        .link-accent { color:var(--brand-primary); }
        .link-accent:hover { color:var(--brand-primary-hover); }
    </style>
    {% block styles %}{% endblock %}
    <script>
        (function() {
            const token = '{{ csrf_token }}';
            window.CSRF_TOKEN = token;

            const originalFetch = window.fetch ? window.fetch.bind(window) : null;
            if (originalFetch) {
                window.fetch = function(resource, config) {
                    config = config || {};
                    const method = (config.method || 'GET').toUpperCase();
                    if (['POST','PUT','PATCH','DELETE'].includes(method)) {
                        if (!config.headers) config.headers = {};
                        if (config.headers instanceof Headers) {
                            config.headers.set('X-CSRF-TOKEN', token);
                        } else if (Array.isArray(config.headers)) {
                            config.headers.push(['X-CSRF-TOKEN', token]);
                        } else {
                            config.headers['X-CSRF-TOKEN'] = token;
                        }
                    }
                    return originalFetch(resource, config);
                };
            }

            document.addEventListener('DOMContentLoaded', function() {
                document.querySelectorAll('form').forEach(function(form) {
                    const method = (form.getAttribute('method') || 'GET').toUpperCase();
                    if (method !== 'POST') return;
                    if (!form.querySelector('input[name="_token"]')) {
                        const input = document.createElement('input');
                        input.type = 'hidden';
                        input.name = '_token';
                        input.value = token;
                        form.appendChild(input);
                    }
                });
            });
        })();
    </script>
</head>

<body class="bg-[var(--brand-bg)]">
    <!-- ========== MARVEL INTRO ========== -->
    <div id="marvel-intro" class="fade-out">
        <div class="intro-container">
            <!-- Particles Background -->
            <div class="particles" id="particles"></div>
            
            <!-- Radial Burst -->
            <div class="radial-burst" id="radialBurst"></div>
            
            <!-- Logo -->
            <div class="logo-wrapper">
                <img src="{{ app_url }}/public/images/logo.png" 
                     alt="BackRoar" 
                     class="logo-image">
            </div>
            
            <!-- Brand Text -->
            <div class="brand-text">BackRoar</div>
        </div>
    </div>
    <!-- ========== END MARVEL INTRO ========== -->

    <!-- ========== MAIN CONTENT WRAPPER ========== -->
    <div id="main-content">
        <!-- Navbar -->
        <nav class="sticky top-0 w-full z-50 bg-white/95 backdrop-blur border-b border-[var(--card-border)] shadow-sm">
            <div class="container mx-auto px-4 py-3 flex items-center justify-between nav-container">
                <!-- Left -->
                <div class="flex items-center gap-3">
                    <button id="menuToggle" aria-label="Menu" class="md:hidden p-2 rounded-lg text-[var(--brand-text)] hover:bg-black/5">
                        <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                  d="M4 6h16M4 12h16M4 18h16"/>
                        </svg>
                    </button>
                    <a href="{{ app_url }}/" class="flex items-center gap-2">
                        <img src="{{ app_url }}/public/images/logo.png" alt="BackRoar" class="w-50 h-10 square" />
                    </a>
                    <span class="hidden md:inline-flex nav-chip ml-1">
                        <span class="dot"></span>
                        <span>Back&nbsp;Roar</span>
                    </span>
                </div>

                <!-- Center -->
                <div class="hidden md:flex items-center gap-6">
                    <a href="{{ app_url }}/" class="nav-link">Home</a>
                <!--    <a href="{{ app_url }}/products" class="nav-link">Shop</a> -->
                    <a href="{{ app_url }}/categories" class="nav-link">Categories</a>
                    <a href="{{ app_url }}/about" class="nav-link">About</a>
                    <a href="{{ app_url }}/contact" class="nav-link">Contact</a>
                </div>

                <!-- Right -->
                <div class="flex items-center gap-2">
                    <input type="search" id="searchInput"
                           placeholder="Search cases"
                           class="hidden md:block nav-input px-3 py-2" />

                    <!-- Desktop cart with backend count -->
                    <a href="{{ app_url }}/cart" aria-label="Cart"
                       class="hidden md:inline-flex items-center gap-2 nav-cta px-3 py-2">
                        <svg class="w-4 h-4" viewBox="0 0 24 24" fill="none" stroke="currentColor">
                            <path d="M6 6h14l-2 8H8L6 6z" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                            <circle cx="9" cy="20" r="1"/><circle cx="17" cy="20" r="1"/>
                        </svg>
                        <span>Cart</span>
                        {% if session.user_id %}
                        <span id="cart-count"
                              class="ml-1 bg-red-500 text-white text-[10px] rounded-full px-1.5 py-0.5 hidden"></span>
                        {% endif %}
                    </a>

                    <!-- User dropdown -->
                    <div class="relative userDropdown">
                        {% if session.user_id %}
                            <button class="hidden md:inline-flex items-center gap-2 px-3 py-2 nav-user-btn userDropdownToggle">
                                <svg class="w-4 h-4" viewBox="0 0 24 24" fill="none" stroke="currentColor">
                                    <circle cx="12" cy="8" r="3" stroke-width="2"/>
                                    <path d="M6 20c0-3.314 2.686-6 6-6s6 2.686 6 6" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                                </svg>
                                <span class="text-xs">{{ session.user_name }}</span>
                                <svg class="w-3 h-3 ml-1" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                          d="M19 9l-7 7-7-7"></path>
                                </svg>
                            </button>
                            <div class="userDropdownMenu absolute right-0 mt-2 w-48 bg-white rounded-md shadow-lg py-1 hidden">
                                <a href="{{ app_url }}/account" class="block px-4 py-2 text-sm text-gray-700 hover:bg-gray-100">My Profile</a>
                                <a href="{{ app_url }}/orders" class="block px-4 py-2 text-sm text-gray-700 hover:bg-gray-100">Orders</a>
                                <a href="{{ app_url }}/wishlist" class="block px-4 py-2 text-sm text-gray-700 hover:bg-gray-100">Wishlist</a>
                                <a href="{{ app_url }}/logout" class="block px-4 py-2 text-sm text-red-600 hover:bg-gray-100">Logout</a>
                            </div>
                        {% else %}
                            <button class="hidden md:inline-flex items-center gap-2 px-3 py-2 nav-user-btn userDropdownToggle">
                                <svg class="w-4 h-4" viewBox="0 0 24 24" fill="none" stroke="currentColor">
                                    <circle cx="12" cy="8" r="3" stroke-width="2"/>
                                    <path d="M6 20c0-3.314 2.686-6 6-6s6 2.686 6 6" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                                </svg>
                                <span class="text-xs">Login</span>
                                <svg class="w-3 h-3 ml-1" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                          d="M19 9l-7 7-7-7"></path>
                                </svg>
                            </button>
                            <div class="userDropdownMenu absolute right-0 mt-2 w-48 bg-white rounded-md shadow-lg py-1 hidden">
                                <a href="{{ app_url }}/login" class="block px-4 py-2 text-sm text-gray-700 hover:bg-gray-100">Login</a>
                                <a href="{{ app_url }}/register" class="block px-4 py-2 text-sm text-gray-700 hover:bg-gray-100">Register</a>
                            </div>
                        {% endif %}
                    </div>

                    <!-- Mobile cart icon with same badge id -->
                    <a href="{{ app_url }}/cart" class="relative md:hidden">
                        <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                  d="M3 3h2l.4 2M7 13h10l4-8H5.4M7 13L5.4 5M7 13l-2.293 2.293c-.63.63-.184 1.707.707 1.707H17m0 0a2 2 0 100 4 2 2 0 000-4zm-8 2a2 2 0 11-4 0 2 2 0 014 0z"></path>
                        </svg>
                        {% if session.user_id %}
                        <span id="cart-count"
                              class="absolute -top-2 -right-2 bg-red-600 text-white text-xs font-bold rounded-full w-5 h-5 hidden items-center justify-center"></span>
                        {% endif %}
                    </a>

                    {% if session.user_id %}
                        <a href="{{ app_url }}/account" aria-label="Account" class="md:hidden p-2 rounded-lg bg-[var(--brand-navbar)] text-white hover:bg-black">
                            <svg class="w-6 h-6" viewBox="0 0 24 24" fill="none" stroke="currentColor">
                                <circle cx="12" cy="8" r="3" stroke-width="2"/>
                                <path d="M6 20c0-3.314 2.686-6 6-6s6 2.686 6 6" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                            </svg>
                        </a>
                    {% else %}
                        <a href="{{ app_url }}/login" aria-label="Account" class="md:hidden p-2 rounded-lg bg-[var(--brand-navbar)] text-white hover:bg-black">
                            <svg class="w-6 h-6" viewBox="0 0 24 24" fill="none" stroke="currentColor">
                                <circle cx="12" cy="8" r="3" stroke-width="2"/>
                                <path d="M6 20c0-3.314 2.686-6 6-6s6 2.686 6 6" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                            </svg>
                        </a>
                    {% endif %}
                </div>
            </div>

            <div id="mobileMenu" class="md:hidden hidden border-t border-gray-200 bg-white">
                <div class="px-4 py-3 space-y-3">
                    <input type="search" placeholder="Search cases" class="w-full px-3 py-2 rounded-lg border border-[var(--card-border)] focus:border-[var(--brand-primary)] focus:ring-2 focus:ring-[var(--brand-primary)] outline-none" />
                    <a href="{{ app_url }}/" class="block text-[var(--brand-text)]">Home</a>
                 <!--   <a href="{{ app_url }}/products" class="block text-[var(--brand-text)]">Shop</a> -->
                    <a href="{{ app_url }}/categories" class="block text-[var(--brand-text)]">Categories</a>
                    <a href="{{ app_url }}/about" class="block text-[var(--brand-text)]">About</a>
                    <a href="{{ app_url }}/contact" class="block text-[var(--brand-text)]">Contact</a>
                    {% if not session.user_id %}
                        <a href="{{ app_url }}/login" class="block text-[var(--brand-text)]">Login</a>
                    {% endif %}
                </div>
            </div>
        </nav>

        {% block content %}{% endblock %}

      <footer class="bg-black text-white py-12">
    <div class="container mx-auto px-4">
        <div class="grid grid-cols-1 md:grid-cols-4 gap-8 mb-8">

            <!-- Useful Links -->
            <div>
                <h4 class="text-lg font-semibold mb-4">USEFUL LINKS</h4>
                <div class="w-12 h-1 bg-green-500 mb-4"></div>
                <ul class="space-y-2 text-gray-400">
                    <li><a href="#" class="hover:text-white">Love from the Customers</a></li>

                    <!-- About & Contact DO NOT EXIST in routes — if you add routes, this becomes correct -->
                    <li><a href="{{ app_url }}/about" class="hover:text-white">About Us</a></li>
                    <li><a href="{{ app_url }}/contact" class="hover:text-white">Contact Us</a></li>

                    <!-- These routes DO NOT EXIST unless you add them manually -->
                    <li><a href="{{ app_url }}/refund-policy" class="hover:text-white">Refund Policy</a></li>
                    <li><a href="{{ app_url }}/privacy-policy" class="hover:text-white">Privacy Policy</a></li>
                    <li><a href="{{ app_url }}/shipping-policy" class="hover:text-white">Shipping Policy</a></li>
                    <li><a href="{{ app_url }}/terms" class="hover:text-white">Terms and Conditions</a></li>
                </ul>
            </div>

            <!-- Account -->
            <div>
                <h4 class="text-lg font-semibold mb-4">ACCOUNT</h4>
                <div class="w-12 h-1 bg-green-500 mb-4"></div>
                <ul class="space-y-2 text-gray-400">
                    <li><a href="{{ app_url }}/orders" class="hover:text-white">My Orders</a></li>
                    <li><a href="{{ app_url }}/account" class="hover:text-white">My Account</a></li>
                    <li><a href="{{ app_url }}/orders" class="hover:text-white">Track Order</a></li>
                    <li><a href="{{ app_url }}/checkout" class="hover:text-white">Checkout</a></li>
                </ul>
            </div>

            <!-- Help Center -->
            <div>
                <h4 class="text-lg font-semibold mb-4">HELP CENTER</h4>
                <div class="w-12 h-1 bg-green-500 mb-4"></div>

                <p class="text-gray-400 mb-2">
                    Support time : 09.30 AM to 06.00 PM (Monday to Saturday)
                </p>
                <p class="text-gray-400 mb-4">Contact@backroar.in</p>

                <h5 class="font-semibold mb-2">Connect with us</h5>
                <div class="flex space-x-4 text-gray-400">
                    <a href="#" class="hover:text-white">FB</a>
                    <a href="#" class="hover:text-white">IG</a>
                </div>
            </div>

            <!-- Office Address -->
            <div>
                <h4 class="text-lg font-semibold mb-4">REGISTERED OFFICE ADDRESS:</h4>
                <div class="w-12 h-1 bg-green-500 mb-4"></div>
                <p class="text-gray-400">Backroar</p>
                <p class="text-gray-400">503 Rhythm Plaza</p>
                <p class="text-gray-400">Nikol Ringroad</p>
                <p class="text-gray-400">Ahmedabad Gujarat - 382350</p>
            </div>
        </div>

        <div class="border-t border-gray-700 pt-8 flex flex-col md:flex-row items-center justify-between text-sm text-gray-400">
            <p>Copyright 2025 © Backroar.in</p>
            <div class="flex gap-2 mt-4 md:mt-0">
                <img src="{{ app_url }}/public/images/final_payments_icon.png" alt="Payment Methods" class="h-6">
            </div>
        </div>
    </div>
</footer>

    </div>
    <!-- ========== END MAIN CONTENT WRAPPER ========== -->

    <!-- ========== MARVEL INTRO SCRIPT ========== -->
    <script>
        // Check if intro has been shown in this session
        const hasSeenIntro = sessionStorage.getItem('blackroar_intro_shown');
        
        if (hasSeenIntro) {
            // Skip intro if already shown
            document.getElementById('marvel-intro').style.display = 'none';
            document.getElementById('main-content').style.opacity = '1';
            document.getElementById('main-content').style.animation = 'none';
        } else {
            // Show intro and mark as shown
            sessionStorage.setItem('blackroar_intro_shown', 'true');
            
            // Generate particles
            const particlesContainer = document.getElementById('particles');
            for (let i = 0; i < 50; i++) {
                const particle = document.createElement('div');
                particle.className = 'particle';
                particle.style.width = Math.random() * 4 + 1 + 'px';
                particle.style.height = particle.style.width;
                particle.style.left = Math.random() * 100 + '%';
                particle.style.top = Math.random() * 100 + '%';
                particle.style.animationDelay = Math.random() * 2 + 's';
                particle.style.animationDuration = Math.random() * 3 + 2 + 's';
                particlesContainer.appendChild(particle);
            }
            
            // Generate radial burst lines
            const burstContainer = document.getElementById('radialBurst');
            for (let i = 0; i < 24; i++) {
                const line = document.createElement('div');
                line.className = 'burst-line';
                line.style.transform = `rotate(${i * 15}deg)`;
                line.style.animationDelay = '1s';
                burstContainer.appendChild(line);
            }
            
            // Remove intro after animation completes
            setTimeout(() => {
                document.getElementById('marvel-intro').remove();
            }, 4800);
        }
    </script>
    <!-- ========== END MARVEL INTRO SCRIPT ========== -->

    <script>
        // Mobile menu
        const menuToggle = document.getElementById('menuToggle');
        const mobileMenu = document.getElementById('mobileMenu');
        if (menuToggle && mobileMenu) {
            menuToggle.addEventListener('click', () => {
                mobileMenu.classList.toggle('hidden');
            });
            mobileMenu.querySelectorAll('a').forEach(a => {
                a.addEventListener('click', () => mobileMenu.classList.add('hidden'));
            });
        }

        // User dropdown
        document.querySelectorAll('.userDropdownToggle').forEach(button => {
            const dropdown = button.closest('.userDropdown');
            const menu = dropdown.querySelector('.userDropdownMenu');
            button.addEventListener('click', (e) => {
                e.stopPropagation();
                menu.classList.toggle('hidden');
            });
            menu.querySelectorAll('a').forEach(link => {
                link.addEventListener('click', () => menu.classList.add('hidden'));
            });
        });
        document.addEventListener('click', () => {
            document.querySelectorAll('.userDropdownMenu').forEach(menu => menu.classList.add('hidden'));
        });
    </script>

    {% if session.user_id %}
    <script>
    // Update cart-count badge from backend for both desktop & mobile
    fetch('{{ app_url }}/cart/count')
        .then(res => res.json())
        .then(data => {
            const badge = document.getElementById('cart-count');
            if (!badge) return;
            if (data.count > 0) {
                badge.textContent = data.count;
                badge.classList.remove('hidden');
                badge.style.display = 'inline-flex';
            } else {
                badge.classList.add('hidden');
            }
        })
        .catch(() => {});
    </script>
    {% endif %}

    {% block scripts %}{% endblock %}
</body>
</html>
