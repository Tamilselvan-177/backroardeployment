<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Order #{{ order.order_number }} ‚Äî Admin</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, sans-serif;
            background: #f9fafb;
        }

        @keyframes adminFadeUp {
            from { opacity:0; transform: translateY(20px); }
            to   { opacity:1; transform: translateY(0); }
        }

        .admin-shell {
            background: radial-gradient(circle at top, #f9fafb 0%, #e5e7eb 40%, #f3f4f6 100%);
            min-height: 100vh;
            padding: 2rem 0;
        }

        .admin-panel {
            animation: adminFadeUp .4s ease-out;
        }

        .admin-card {
            background: #ffffff;
            border-radius: 1.1rem;
            box-shadow: 0 18px 40px rgba(15,23,42,0.12), 0 0 0 1px rgba(148,163,184,0.25);
            border: 1px solid rgba(148,163,184,0.5);
        }

        .admin-pill {
            font-size: .7rem;
            text-transform: uppercase;
            letter-spacing: .18em;
            color: #6b7280;
        }

        .status-pill {
            font-size: 11px;
            padding: 0.3rem 0.8rem;
            border-radius: 999px;
            font-weight: 600;
            display: inline-block;
        }

        .info-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 1.5rem;
        }

        @media (max-width: 768px) {
            .info-grid {
                grid-template-columns: 1fr;
            }
        }

        .info-section {
            padding: 1.5rem;
            background: #f9fafb;
            border-radius: 0.8rem;
            border: 1px solid #e5e7eb;
        }

        .info-label {
            font-size: 0.75rem;
            text-transform: uppercase;
            letter-spacing: 0.1em;
            color: #6b7280;
            margin-bottom: 0.3rem;
            font-weight: 600;
        }

        .info-value {
            font-size: 0.95rem;
            color: #1f2937;
            margin-bottom: 1rem;
            word-break: break-word;
        }

        .address-box {
            background: white;
            padding: 1.2rem;
            border-radius: 0.8rem;
            border-left: 3px solid #2196F3;
        }

        .items-table {
            width: 100%;
            border-collapse: collapse;
        }

        .items-table thead {
            background: #f3f4f6;
        }

        .items-table th,
        .items-table td {
            padding: 0.8rem;
            text-align: left;
            border-bottom: 1px solid #e5e7eb;
            font-size: 0.9rem;
        }

        .items-table th {
            font-weight: 600;
            color: #374151;
        }

        .print-btn {
            background: #2196F3;
            color: white;
            padding: 0.6rem 1.2rem;
            border: none;
            border-radius: 0.5rem;
            cursor: pointer;
            font-weight: 600;
            font-size: 0.9rem;
            transition: background 0.3s;
        }

        .print-btn:hover {
            background: #1976D2;
        }

        .container {
            max-width: 1000px;
            margin: 0 auto;
            padding: 0 1rem;
        }

        /* Print Styles */
        @page { 
            size: A4; 
            margin: 10mm; 
        }

        .print-label { 
            display: none; 
        }
        
        @media print {
            .no-print { 
                display: none !important; 
            }

            body { 
                background: white !important; 
                margin: 0 !important; 
                padding: 0 !important; 
            }

            .admin-shell { 
                display: none !important; 
            }

            .admin-panel { 
                display: none !important; 
            }
            
            .print-label { 
                display: block !important; 
                width: 100% !important;
                max-width: 100% !important;
                padding: 0 !important;
                margin: 0 !important;
                page-break-after: avoid !important;
            }
            
            .print-header { 
                display: flex; 
                justify-content: space-between; 
                align-items: center; 
                margin-bottom: 10px;
                padding-bottom: 10px;
                border-bottom: 3px solid #000;
            }
            
            .print-header > div:first-child { 
                font-size: 18px !important; 
                font-weight: 700 !important; 
            }
            
            .print-header > div:last-child { 
                font-size: 11px !important; 
            }
            
            .print-box { 
                border: 1px solid #d1d5db; 
                border-radius: 6px; 
                padding: 10px; 
                background: #fff; 
                margin-bottom: 10px;
                page-break-inside: avoid;
            }
            
            .print-box-label {
                font-size: 9px !important;
                text-transform: uppercase;
                letter-spacing: 0.05em;
                color: #4b5563 !important;
                margin-bottom: 5px;
                font-weight: 700 !important;
                display: block;
            }
            
            .print-items { 
                display: grid; 
                grid-template-columns: repeat(3, 1fr); 
                gap: 8px; 
                margin-top: 8px; 
            }
            
            .print-item { 
                display: flex; 
                gap: 6px; 
                align-items: center; 
                border: 1px solid #e5e7eb; 
                border-radius: 4px; 
                padding: 6px;
                page-break-inside: avoid;
            }
            
            .thumb { 
                width: 42px; 
                height: 42px; 
                background: #f3f4f6; 
                border-radius: 4px; 
                display: flex; 
                align-items: center; 
                justify-content: center; 
                overflow: hidden;
                flex-shrink: 0;
            }
            
            .thumb img { 
                width: 100%; 
                height: 100%; 
                object-fit: contain; 
            }
            
            .print-label * { 
                color: #000 !important; 
                font-size: 10px !important;
            }
            
            .print-total {
                font-size: 12px !important;
                font-weight: 700 !important;
            }

            .print-status-badge {
                display: inline-block;
                padding: 3px 8px;
                border-radius: 4px;
                font-size: 9px !important;
                font-weight: 600 !important;
                margin-left: 6px;
            }

            .discount-row {
                color: #059669 !important;
            }
        }
    </style>
</head>
<body>
    <section class="admin-shell">
        <div class="container admin-panel">
            <!-- Header -->
            <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 1.5rem;" class="no-print">
                <div>
                    <p class="admin-pill" style="margin-bottom: 0.25rem;">Admin / Orders / Details</p>
                    <h1 style="font-size: 1.875rem; font-weight: 900; letter-spacing: 0.14em; text-transform: uppercase;">
                        Order #{{ order.order_number }}
                    </h1>
                </div>
                <div>
                    <button class="print-btn no-print" onclick="window.print()">üñ®Ô∏è Print Label</button>
                </div>
            </div>

            <!-- Success/Error Messages -->
            {% if session.flash.success %}
            <div class="no-print" style="margin-bottom: 1rem; padding: 0.75rem 1rem; border-radius: 0.5rem; background: #f0fdf4; border: 1px solid #bbf7d0; font-size: 0.875rem; color: #15803d;">
                {{ session.flash.success }}
            </div>
            {% endif %}

            <!-- Order Overview -->
            <div class="admin-card" style="margin-bottom: 1.5rem;">
                <div style="padding: 1.5rem; border-bottom: 1px solid #e5e7eb;">
                    <div style="display: flex; justify-content: space-between; align-items: center; flex-wrap: wrap; gap: 1rem;">
                        <div>
                            <p class="admin-pill" style="margin-bottom: 0.5rem;">Order Status</p>
                            <div style="display: flex; gap: 1rem; flex-wrap: wrap;">
                                {% set s = order.order_status %}
                                {% if s == 'Pending' %}
                                    <span class="status-pill bg-gray-100 text-gray-700" style="background: #f3f4f6; color: #374151;">Pending</span>
                                {% elseif s == 'Confirmed' %}
                                    <span class="status-pill" style="background: #dbeafe; color: #1e40af;">Confirmed</span>
                                {% elseif s == 'Processing' %}
                                    <span class="status-pill" style="background: #e0e7ff; color: #4338ca;">Processing</span>
                                {% elseif s == 'Shipped' %}
                                    <span class="status-pill" style="background: #e0f2fe; color: #0369a1;">Shipped</span>
                                {% elseif s == 'Delivered' %}
                                    <span class="status-pill" style="background: #d1fae5; color: #065f46;">Delivered</span>
                                {% else %}
                                    <span class="status-pill" style="background: #fee2e2; color: #991b1b;">Cancelled</span>
                                {% endif %}

                                {% if order.payment_status == 'Paid' %}
                                    <span class="status-pill" style="background: #d1fae5; color: #065f46;">Payment: Paid</span>
                                {% elseif order.payment_status == 'Failed' %}
                                    <span class="status-pill" style="background: #fee2e2; color: #991b1b;">Payment: Failed</span>
                                {% else %}
                                    <span class="status-pill" style="background: #fef3c7; color: #92400e;">Payment: {{ order.payment_status }}</span>
                                {% endif %}
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Customer & Delivery Info -->
                <div style="padding: 1.5rem;">
                    <div class="info-grid">
                        <!-- Customer Info -->
                        <div class="info-section">
                            <div class="info-label">üë§ Customer Information</div>
                            <div class="info-value"><strong>Name:</strong> {{ order.user_name ?? 'N/A' }}</div>
                            <div class="info-value"><strong>Email:</strong> {{ order.user_email ?? 'N/A' }}</div>
                            <div class="info-value"><strong>Phone:</strong> {{ order.user_phone ?? 'N/A' }}</div>
                            <div class="info-value"><strong>Order Date:</strong> {{ order.created_at|date('d M Y, H:i') }}</div>
                        </div>

                        <!-- Delivery Address -->
                        <div class="info-section">
                            <div class="info-label">üìç Delivery Address</div>
                            <div class="address-box">
                                <div style="font-weight: 600; font-size: 0.95rem; color: #1f2937; margin-bottom: 0.5rem;">
                                    {{ order.shipping_name }}
                                </div>
                                <div style="font-size: 0.85rem; color: #374151; line-height: 1.6;">
                                    {{ order.shipping_address }}<br>
                                    {% if order.shipping_address_line2 %}
                                        {{ order.shipping_address_line2 }}<br>
                                    {% endif %}
                                    {{ order.shipping_city }}, {{ order.shipping_state }}<br>
                                    <strong>üìÆ PIN: {{ order.shipping_pincode }}</strong><br>
                                    <strong>üìû {{ order.shipping_phone }}</strong>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Order Items -->
            <div class="admin-card" style="margin-bottom: 1.5rem;">
                <div style="padding: 1.5rem; border-bottom: 1px solid #e5e7eb;">
                    <h2 style="margin: 0; font-size: 1.1rem; font-weight: 600;">üì¶ Order Items</h2>
                </div>
                <div style="overflow-x: auto;">
                    <table class="items-table">
                        <thead>
                            <tr>
                                <th>Product</th>
                                <th>Quantity</th>
                                <th>Price</th>
                                <th>Subtotal</th>
                            </tr>
                        </thead>
                        <tbody>
                            {% for item in items %}
                            <tr>
                                <td>
                                    <div style="display:flex; align-items:center; gap:.75rem;">
                                        <div style="width:52px; height:52px; border-radius:.5rem; background:#f3f4f6; display:flex; align-items:center; justify-content:center; overflow:hidden;">
                                            {% if item.image_path %}
                                            <img src="{{ item.image_path }}" alt="{{ item.product_name }}" style="width:100%; height:100%; object-fit:contain;" />
                                            {% else %}
                                            <span>üì¶</span>
                                            {% endif %}
                                        </div>
                                        <div>
                                            <div style="font-weight:600;">{{ item.product_name }}</div>
                                            {% if item.product_slug %}
                                            <div style="font-size:.8rem; color:#6b7280;">/{{ item.product_slug }}</div>
                                            {% endif %}
                                        </div>
                                    </div>
                                </td>
                                <td style="text-align: center;">{{ item.quantity }}</td>
                                <td>‚Çπ{{ item.price|number_format(2) }}</td>
                                <td><strong>‚Çπ{{ item.subtotal|number_format(2) }}</strong></td>
                            </tr>
                            {% endfor %}
                        </tbody>
                    </table>
                </div>
                
                <!-- Order Summary -->
                <div style="padding: 1.5rem; background: #f9fafb; border-top: 1px solid #e5e7eb; display: flex; justify-content: flex-end;">
                    <div style="width: 100%; max-width: 400px;">
                        <div style="display: flex; justify-content: space-between; margin-bottom: 0.8rem; font-size: 0.9rem;">
                            <span>Subtotal:</span>
                            <span>‚Çπ{{ order.subtotal|number_format(2) }}</span>
                        </div>
                        {% if order.discount_amount > 0 %}
                        <div style="display: flex; justify-content: space-between; margin-bottom: 0.8rem; font-size: 0.9rem; color: #10b981;">
                            <span>Discount ({{ order.coupon_code }}):</span>
                            <span>-‚Çπ{{ order.discount_amount|number_format(2) }}</span>
                        </div>
                        {% endif %}
                        <div style="display: flex; justify-content: space-between; margin-bottom: 0.8rem; font-size: 0.9rem;">
                            <span>Shipping:</span>
                            <span>‚Çπ{{ order.shipping_charge|number_format(2) }}</span>
                        </div>
                        <div style="display: flex; justify-content: space-between; padding-top: 0.8rem; border-top: 2px solid #d1d5db; font-size: 1.1rem; font-weight: 600;">
                            <span>Total Amount:</span>
                            <span style="color: #2196F3;">‚Çπ{{ order.total_amount|number_format(2) }}</span>
                        </div>
                        <div style="margin-top: 0.8rem; font-size: 0.85rem; color: #6b7280;">
                            <strong>Payment Method:</strong> {{ order.payment_method ?? 'COD' }}
                        </div>
                    </div>
                </div>
            </div>

            <!-- Update Status Form -->
            <div class="admin-card no-print">
                <div style="padding: 1.5rem; border-bottom: 1px solid #e5e7eb;">
                    <h2 style="margin: 0; font-size: 1.1rem; font-weight: 600;">Update Delivery Status</h2>
                </div>
                <div style="padding: 1.5rem;">
                    <form action="{{ app_url }}/admin/orders/{{ order.id }}/status" method="post" style="display: flex; gap: 1rem; flex-wrap: wrap;">
                        <input type="hidden" name="_token" value="{{ csrf_token }}">
                        <select name="order_status" style="flex: 1; min-width: 200px; padding: 0.6rem; border: 1px solid #d1d5db; border-radius: 0.5rem; font-size: 0.9rem;">
                            {% for s in ['Pending','Confirmed','Processing','Shipped','Delivered','Cancelled'] %}
                            <option value="{{ s }}" {% if s == order.order_status %}selected{% endif %}>{{ s }}</option>
                            {% endfor %}
                        </select>
                        <button type="submit" class="print-btn" style="background: #10b981; min-width: 120px;">
                            Update Status
                        </button>
                    </form>
                </div>
            </div>

            <!-- Back Link -->
            <div style="margin-top: 2rem;" class="no-print">
                <a href="{{ app_url }}/admin/orders" style="color: #2196F3; text-decoration: none; font-weight: 500;">
                    ‚Üê Back to Orders
                </a>
            </div>
        </div>
    </section>

    <!-- Enhanced Print Label -->
    <section class="print-label">
        <div class="print-header">
            <div>Order #{{ order.order_number }}
                {% set s = order.order_status %}
                {% if s == 'Shipped' %}
                    <span class="print-status-badge" style="background:#e0f2fe; color:#0369a1;">SHIPPED</span>
                {% elseif s == 'Delivered' %}
                    <span class="print-status-badge" style="background:#d1fae5; color:#065f46;">DELIVERED</span>
                {% elseif s == 'Processing' %}
                    <span class="print-status-badge" style="background:#e0e7ff; color:#4338ca;">PROCESSING</span>
                {% endif %}
            </div>
            <div>{{ order.created_at|date('d M Y, H:i') }}</div>
        </div>
        
        <div class="print-box">
            <span class="print-box-label">üôç CUSTOMER</span>
            <div style="font-weight:700; font-size:11px !important;">{{ order.shipping_name }}</div>
            <div style="font-size:10px !important;">üìû {{ order.user_phone ?? order.shipping_phone }}</div>
            {% if order.user_email %}
            <div style="font-size:9px !important; color:#6b7280 !important;">‚úâ {{ order.user_email }}</div>
            {% endif %}
        </div>
        
        <div class="print-box">
            <span class="print-box-label">üìç DELIVERY ADDRESS</span>
            <div style="font-size:10px !important; line-height:1.5;">
                {{ order.shipping_address }}{% if order.shipping_address_line2 %}, {{ order.shipping_address_line2 }}{% endif %}<br>
                {{ order.shipping_city }}, {{ order.shipping_state }} - <strong>{{ order.shipping_pincode }}</strong>
            </div>
            <div style="margin-top:5px; font-size:9px !important; color:#6b7280 !important;">
                üí≥ {{ order.payment_method ?? 'COD' }} ‚Ä¢ {{ order.payment_status }}
            </div>
        </div>
        
        <div class="print-box">
            <span class="print-box-label">üì¶ ORDER ITEMS</span>
            <div class="print-items">
                {% for item in items %}
                <div class="print-item">
                    <div class="thumb">
                        {% if item.image_path %}
                        <img src="{{ item.image_path }}" alt="{{ item.product_name }}" />
                        {% else %}
                        <span style="font-size:18px;">üì¶</span>
                        {% endif %}
                    </div>
                    <div style="flex:1; min-width:0;">
                        <div style="font-weight:700; font-size:10px !important; white-space:nowrap; overflow:hidden; text-overflow:ellipsis;">{{ item.product_name }}</div>
                        <div style="color:#6b7280 !important; font-size:9px !important;">Qty: {{ item.quantity }} √ó ‚Çπ{{ item.price|number_format(2) }}</div>
                    </div>
                    <div style="font-weight:700; white-space:nowrap; font-size:10px !important;">‚Çπ{{ item.subtotal|number_format(2) }}</div>
                </div>
                {% endfor %}
            </div>
        </div>
        
        <div class="print-box">
            <span class="print-box-label">üí∞ PAYMENT SUMMARY</span>
            <div style="display:flex; justify-content:space-between; margin-bottom:4px; font-size:10px !important;">
                <span>Subtotal:</span>
                <span>‚Çπ{{ order.subtotal|number_format(2) }}</span>
            </div>
            {% if order.discount_amount > 0 %}
            <div class="discount-row" style="display:flex; justify-content:space-between; margin-bottom:4px; font-size:10px !important; font-weight:600 !important;">
                <span>üéâ Discount ({{ order.coupon_code }}):</span>
                <span>-‚Çπ{{ order.discount_amount|number_format(2) }}</span>
            </div>
            {% endif %}
            <div style="display:flex; justify-content:space-between; margin-bottom:4px; font-size:10px !important;">
                <span>Shipping:</span>
                <span>‚Çπ{{ order.shipping_charge|number_format(2) }}</span>
            </div>
            <div style="display:flex; justify-content:space-between; padding-top:6px; border-top:2px solid #000; margin-top:4px;">
                <span class="print-total">TOTAL AMOUNT:</span>
                <span class="print-total">‚Çπ{{ order.total_amount|number_format(2) }}</span>
            </div>
        </div>
    </section>
</body>
</html>