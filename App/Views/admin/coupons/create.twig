{% extends 'base.twig' %}

{% block title %}{{ title }}{% endblock %}

{% block content %}
<section class="py-10 bg-gray-50 min-h-screen">
    <div class="container mx-auto px-4 max-w-3xl">
        <!-- Header -->
        <div class="mb-8">
            <a href="{{ app_url }}/admin/coupons" 
               class="text-blue-600 hover:text-blue-800 font-semibold text-sm mb-4 inline-block">
                ← Back to Coupons
            </a>
            <h1 class="text-3xl font-bold text-gray-900">Create New Coupon</h1>
        </div>

        <!-- Form -->
        <form method="POST" action="{{ app_url }}/admin/coupons/store" class="bg-white rounded-lg shadow p-8">
           
<input type="hidden" name="_token" value="{{ csrf_token }}">
            <!-- Coupon Code -->
            <div class="mb-6">
                <label class="block text-sm font-bold text-gray-700 mb-2">
                    Coupon Code *
                </label>
                <input type="text" 
                       name="code" 
                       value="{{ old.code }}"
                       placeholder="e.g., WELCOME10, SUMMER25"
                       class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent uppercase"
                       required>
                {% if errors.code %}
                <p class="text-red-600 text-sm mt-1">{{ errors.code }}</p>
                {% endif %}
                <p class="text-xs text-gray-500 mt-1">Use uppercase letters and numbers only</p>
            </div>

            <!-- Description -->
            <div class="mb-6">
                <label class="block text-sm font-bold text-gray-700 mb-2">
                    Description (Optional)
                </label>
                <textarea name="description" 
                          rows="2"
                          placeholder="Internal note about this coupon"
                          class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent">{{ old.description }}</textarea>
            </div>

            <!-- Discount Type & Value -->
            <div class="grid grid-cols-1 md:grid-cols-2 gap-6 mb-6">
                <div>
                    <label class="block text-sm font-bold text-gray-700 mb-2">
                        Discount Type *
                    </label>
                    <select name="discount_type" 
                            id="discountType"
                            class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent"
                            required>
                        <option value="percentage" {% if old.discount_type == 'percentage' %}selected{% endif %}>Percentage (%)</option>
                        <option value="fixed" {% if old.discount_type == 'fixed' %}selected{% endif %}>Fixed Amount (₹)</option>
                    </select>
                </div>

                <div>
                    <label id="discountValueLabel" class="block text-sm font-bold text-gray-700 mb-2">
                        Discount Value *
                    </label>
                    <input type="number" 
                           id="discountValue"
                           name="discount_value" 
                           value="{{ old.discount_value }}"
                           step="0.01"
                           min="1"
                           placeholder="e.g., 10"
                           class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent">
                    {% if errors.discount_value %}
                    <p class="text-red-600 text-sm mt-1">{{ errors.discount_value }}</p>
                    {% endif %}
                </div>
            </div>

            <!-- Min Purchase & Max Discount -->
            <div class="grid grid-cols-1 md:grid-cols-2 gap-6 mb-6">
                <div>
                    <label class="block text-sm font-bold text-gray-700 mb-2">
                        Minimum Purchase (₹)
                    </label>
                    <input type="number" 
                           name="min_purchase" 
                           value="{{ old.min_purchase|default(0) }}"
                           step="0.01"
                           min="0"
                           placeholder="0 = No minimum"
                           class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent">
                    <p class="text-xs text-gray-500 mt-1">Leave 0 for no minimum</p>
                </div>

                <div id="maxDiscountField">
                    <label class="block text-sm font-bold text-gray-700 mb-2">
                        Maximum Discount (₹)
                    </label>
                    <input type="number" 
                           name="max_discount" 
                           value="{{ old.max_discount|default(0) }}"
                           step="0.01"
                           min="0"
                           placeholder="0 = No limit"
                           class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent">
                    <p class="text-xs text-gray-500 mt-1">Only for percentage type</p>
                </div>
            </div>

            <!-- Usage Limits -->
            <div class="grid grid-cols-1 md:grid-cols-2 gap-6 mb-6">
                <div>
                    <label class="block text-sm font-bold text-gray-700 mb-2">
                        Total Usage Limit
                    </label>
                    <input type="number" 
                           name="usage_limit" 
                           value="{{ old.usage_limit|default(0) }}"
                           min="0"
                           placeholder="0 = Unlimited"
                           class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent">
                    <p class="text-xs text-gray-500 mt-1">Total times this can be used</p>
                </div>

                <div>
                    <label class="block text-sm font-bold text-gray-700 mb-2">
                        Per User Limit
                    </label>
                    <input type="number" 
                           name="per_user_limit" 
                           value="{{ old.per_user_limit|default(0) }}"
                           min="0"
                           placeholder="0 = Unlimited"
                           class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent">
                    <p class="text-xs text-gray-500 mt-1">Times per customer</p>
                </div>
            </div>

            <!-- Valid Period -->
            <div class="grid grid-cols-1 md:grid-cols-2 gap-6 mb-6">
                <div>
                    <label class="block text-sm font-bold text-gray-700 mb-2">
                        Valid From *
                    </label>
                    <input type="datetime-local" 
                           name="valid_from" 
                           value="{{ old.valid_from }}"
                           class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent"
                           required>
                    {% if errors.valid_from %}
                    <p class="text-red-600 text-sm mt-1">{{ errors.valid_from }}</p>
                    {% endif %}
                </div>

                <div>
                    <label class="block text-sm font-bold text-gray-700 mb-2">
                        Valid To *
                    </label>
                    <input type="datetime-local" 
                           name="valid_to" 
                           value="{{ old.valid_to }}"
                           class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent"
                           required>
                    {% if errors.valid_to %}
                    <p class="text-red-600 text-sm mt-1">{{ errors.valid_to }}</p>
                    {% endif %}
                </div>
            </div>

            <!-- Is Active -->
            <div class="mb-8">
                <label class="flex items-center">
                    <input type="checkbox" 
                           name="is_active" 
                           {% if old.is_active is not defined or old.is_active %}checked{% endif %}
                           class="w-4 h-4 text-blue-600 border-gray-300 rounded focus:ring-blue-500">
                    <span class="ml-2 text-sm font-semibold text-gray-700">Activate this coupon immediately</span>
                </label>
            </div>

            <!-- Actions -->
            <div class="flex gap-4">
                <button type="submit" 
                        class="px-8 py-3 bg-black text-white rounded-lg font-bold hover:bg-gray-800">
                    Create Coupon
                </button>
                <a href="{{ app_url }}/admin/coupons" 
                   class="px-8 py-3 border border-gray-300 rounded-lg font-bold hover:bg-gray-50">
                    Cancel
                </a>
            </div>
        </form>
    </div>
</section>

<script>
document.addEventListener('DOMContentLoaded', function() {
    const discountType = document.getElementById('discountType');
    const maxDiscountField = document.getElementById('maxDiscountField');
    const discountValue = document.getElementById('discountValue');
    const discountValueLabel = document.getElementById('discountValueLabel');
    
    function toggleMaxDiscount() {
        if (discountType.value === 'fixed') {
            maxDiscountField.style.opacity = '0.5';
            maxDiscountField.querySelector('input').disabled = true;
            discountValue.step = '0.01';
            discountValue.removeAttribute('max');
            discountValueLabel.textContent = 'Amount (₹) *';
            discountValue.placeholder = 'e.g., 1000';
        } else {
            maxDiscountField.style.opacity = '1';
            maxDiscountField.querySelector('input').disabled = false;
            discountValue.step = '1';
            discountValue.setAttribute('max', '100');
            discountValueLabel.textContent = 'Percentage (%) *';
            discountValue.placeholder = 'e.g., 10';
        }
    }
    
    discountType.addEventListener('change', toggleMaxDiscount);
    toggleMaxDiscount();
});
</script>
{% endblock %}
